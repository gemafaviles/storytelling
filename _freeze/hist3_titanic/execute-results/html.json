{
  "hash": "3e632b707fd2cf19c616eb15b57537ea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"¿Quién sobrevivió al Titanic?\"\nauthor:\n  - Gema Fernández-Avilés (Gema.FAviles@uclm.es)\n  - Isidro Hidalgo (Isidro.Hidalgo@uclm.es)\nformat:\n  html:\n    theme: cerulean\n    highlight-style: ayu-mirage\n    self-contained: true\n    lang: es\n    date: 01/20/2025\n    date-format: long\n    embed-resources: true\n    toc-title: Summary\n    toc: true\n    number-sections: true\n    preview-links: auto\n    code-link: true\nnumber-sections: true\nexecute:\n  echo: true\n  eval: true\n  output: true\n  include: true\n  freeze: auto\n  fig-height: 5\n  warning: false\n  comment: \"#>\"\n  code-line-numbers: true\n  code-copy: true\n  code-overflow: scroll\n---\n\n\n::: {.callout-note}\nLos datos para esta historia están sacados de la competición de kaggle [Titanic - Machine Learning from Disaster](https://www.kaggle.com/competitions/titanic). Los datasets de entrenamiento y test se encuentran en el objeto `titanic` del paquete `titanic`.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Instalación y/o carga del paquete `titanic`\"}\nif (!require(titanic)){install.packages(\"titanic\")}\n```\n:::\n\n:::\n\nMi colega de departamento se ha picado con el departamento vecino, y se han apostado que ganaban el próximo datathon de GAIA-X. No pasaría nada, sería su problema, si no me hubiera pedido que le ayudara con el análisis exploratorio, que está mal de tiempo... lo de siempre... ¡¿Pero por qué no pueden dejarme tranquilo?!\n\n# Entender el contexto\n\n::: {.callout-tip}\n\n## Cómo definir el propósito y la audiencia de tu análisis\n\nEn este caso, puesto que el objetivo de mi colega es la predicción, lo primero que vamos a hacer es un análisis exploratorio, para ver las relaciones entre las variables del conjunto de datos. Luego ya se apañará mi compañero para modelizar... ¡a ver si se piensa que lo voy a hacer todo yo!\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Lectura de bibliotecas\"}\n#library(titanic)\nlibrary(tidyverse)\nif (!require(readxl)){install.packages(\"readxl\")}\nlibrary(readxl)\nlibrary(skimr)\nlibrary(explore)\nlibrary(ggmosaic)\nlibrary(ggalluvial)\nlibrary(visdat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Lectura de datos de los datos\"}\ntitanic <- read_xlsx(\"data/titanic.xlsx\")\nhead(titanic, 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 12\n  PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin\n        <dbl>    <dbl>  <dbl> <chr>   <chr> <dbl> <dbl> <dbl> <chr>  <dbl> <chr>\n1           1        0      3 Braund… male     22     1     0 A/5 2…  7.25 <NA> \n2           2        1      1 Cuming… fema…    38     1     0 PC 17… 71.3  C85  \n3           3        1      3 Heikki… fema…    26     0     0 STON/…  7.92 <NA> \n# ℹ 1 more variable: Embarked <chr>\n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"Lectura de datos de los datos\"}\n# Podríamos descargarlo directamente del paquete titanic:\n# titanic <- titanic::titanic_train\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Nombre de las variables en español y primera visualización\"}\nnames(titanic)[1:6] <- c(\"id\", \"supervivencia\", \"clase\", \"nombre\", \"sexo\", \"edad\")\nhead(titanic, 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 12\n     id supervivencia clase nombre    sexo   edad SibSp Parch Ticket  Fare Cabin\n  <dbl>         <dbl> <dbl> <chr>     <chr> <dbl> <dbl> <dbl> <chr>  <dbl> <chr>\n1     1             0     3 Braund, … male     22     1     0 A/5 2…  7.25 <NA> \n2     2             1     1 Cumings,… fema…    38     1     0 PC 17… 71.3  C85  \n3     3             1     3 Heikkine… fema…    26     0     0 STON/…  7.92 <NA> \n# ℹ 1 more variable: Embarked <chr>\n```\n\n\n:::\n:::\n\n\nUn paquete muy interesante para el análisis exploratorio es `skim`\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"skimr es un paquete que conviene memorizar\"}\nskim(titanic)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |        |\n|:------------------------|:-------|\n|Name                     |titanic |\n|Number of rows           |891     |\n|Number of columns        |12      |\n|_______________________  |        |\n|Column type frequency:   |        |\n|character                |5       |\n|numeric                  |7       |\n|________________________ |        |\n|Group variables          |None    |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|nombre        |         0|          1.00|  12|  82|     0|      891|          0|\n|sexo          |         0|          1.00|   4|   6|     0|        2|          0|\n|Ticket        |         0|          1.00|   3|  18|     0|      681|          0|\n|Cabin         |       687|          0.23|   1|  15|     0|      147|          0|\n|Embarked      |         2|          1.00|   1|   1|     0|        3|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|     sd|   p0|    p25|    p50|   p75|   p100|hist  |\n|:-------------|---------:|-------------:|------:|------:|----:|------:|------:|-----:|------:|:-----|\n|id            |         0|           1.0| 446.00| 257.35| 1.00| 223.50| 446.00| 668.5| 891.00|▇▇▇▇▇ |\n|supervivencia |         0|           1.0|   0.38|   0.49| 0.00|   0.00|   0.00|   1.0|   1.00|▇▁▁▁▅ |\n|clase         |         0|           1.0|   2.31|   0.84| 1.00|   2.00|   3.00|   3.0|   3.00|▃▁▃▁▇ |\n|edad          |       177|           0.8|  29.70|  14.53| 0.42|  20.12|  28.00|  38.0|  80.00|▂▇▅▂▁ |\n|SibSp         |         0|           1.0|   0.52|   1.10| 0.00|   0.00|   0.00|   1.0|   8.00|▇▁▁▁▁ |\n|Parch         |         0|           1.0|   0.38|   0.81| 0.00|   0.00|   0.00|   0.0|   6.00|▇▁▁▁▁ |\n|Fare          |         0|           1.0|  32.20|  49.69| 0.00|   7.91|  14.45|  31.0| 512.33|▇▁▁▁▁ |\n\n\n:::\n:::\n\n\n# Elegir una visualización adecuada\n\n::: {.callout-tip}\n## Selección de gráficos y visualizaciones que mejor representen tus datos.\n:::\n\n## ¿Hombre o mujer?\n\nUna pregunta que podemos hacernos enseguida es: ¿influyó el sexo en la supervivencia?\n\nSi usamos un **diagrama de mosaico**, que es un método gráfico para visualizar datos de dos o más variables cualitativas, podemos tener una visión general de los datos y reconocer relaciones entre diferentes variables cualitativas.\n\nVeamos la `supervivencia` de los pasajeros del Titanic en función del `sexo` (ambas variables cualitativas).\n\n::: {.callout-important title=\"Tu turno\"}\nCompleta las partes del código señaladas por `_____` o `xxxxx` para obtener el resultado propuesto.\n:::\n\n### Paso 1: Convierte las variables a `factor`\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Prepara los datos\"}\ntitanic_mosaico <- titanic |>                  # Carga el dataset titanic_mosaico\n  select(clase, sexo, edad, supervivencia) |>  # Selecciona las columnas clase, sexo, edad y supervivencia\n  mutate_all(as.factor)                        # Convierte todas las columnas seleccionadas a factores\n```\n:::\n\n\n\n### Paso 2: Primer mosaico con las variables `supervivencia` y `sexo`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaico2 <- ggplot(data = titanic_mosaico) +        # Crea un gráfico con el dataset titanic_mosaico\n  geom_xxxxx(aes(x = product(supervivencia, sexo),  # Combina supervivencia y sexo en el eje x\n                  fill = supervivencia))            # Colorea los mosaicos según la variable supervivencia\n\nmosaico2       \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](hist3_titanic_files/figure-html/mosaico-superviencia-sexo-1.png){width=672}\n:::\n:::\n\n\n## ¿A qué clase perteneces?¿Eres miembro de la tripulación? ¿Hombre o mujer?\n\nAvanzamos un poco más con los gráficos de mosaico, representando tres variables cualitativas.\n\nVeamos la `supervivencia` de los pasajeros del Titanic en función del `sexo` y la `clase` (todas las variables cualitativas)\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"mosaico de 3 variables\"}\nmosaico3 <- ggplot(data = titanic_mosaico) +\n  geom_mosaic(aes(x = product(supervivencia, sexo, clase), \n                  fill = supervivencia))\nmosaico3\n```\n\n::: {.cell-output-display}\n![](hist3_titanic_files/figure-html/mosaico_superviencia_sexo_clase-1.png){width=672}\n:::\n:::\n\n\n# Eliminar el desorden. Enfocar la atención\n\nEl gráfico anterior es muy complicado de interpretar y exige un enorme esfuerzo del lector, por su elevada carga cognitiva. **¿Podemos facilitarle la vida?**, porque... ¡de eso se trata en visualización!\n\n## El diagrama de flujo\n\nUn diagrama de flujo es un gráfico que muestra los pasos de un proceso de una manera visual y fácil de entender, por tanto, este tipo de gráficos permitirán visualizar el flujo de los datos a través de las variables que analizamos. Véase como mejora la interpretabilidad de los datos cualitativos respecto al mosaico con tres variables cualitativas.\n\nAnalizamos las mismas variables cualitativas: `supervivencia`, `sexo` y `clase`, pero ahora **el gráfico es mucho más fácil de leer y, por tanto, estamos facilitando el mensaje**. En esto consiste eliminar el desorden.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Construimos el diagrama de flujo\"}\ntabla_titanic <- titanic |>   \n  group_by(clase, sexo, supervivencia) |>  # Agrupa los datos por clase, sexo y supervivencia\n  count()                                  # Cuenta el número de ocurrencias en cada grupo\n\nflujo <- ggplot(tabla_titanic,             # Crea un gráfico con la tabla agrupada\n       aes(axis1 = sexo,                   # Define el primer eje como sexo\n           axis2 = clase,                  # Define el segundo eje como clase\n           axis3 = supervivencia,          # Define el tercer eje como supervivencia\n           y = n)) +                       # Usa la columna n para la altura de los estratos\n  geom_alluvium(aes(fill = sexo)) +        # Añade las corrientes (alluviums) o flujos coloreadas por sexo\n  geom_stratum() +                         # Añade los estratos (strata) o categorías\n  geom_text(stat = \"stratum\",              # Añade etiquetas a los estratos \n            aes(label = after_stat(stratum))) +  # Usa el nombre del estrato como etiqueta\n  scale_x_discrete(limits = c(\"clase\", \"sexo\", \"supervivencia\"),  # Define los límites de los ejes x\n                   expand = c(.1, .1)) +  # Añade espacio alrededor de los ejes\n  scale_fill_viridis_d() +                # Aplica una paleta de colores viridis\n  labs(title = \"Las mujeres de primera clase tuvieron preferencia\", \n       y = \"Frecuencia\") +  \n  theme_minimal() +   \n  theme(legend.position = \"none\",  # Elimina la leyenda\n        axis.title.y = element_text(hjust = 1))   \n\nflujo  # Muestra el gráfico\n```\n\n::: {.cell-output-display}\n![](hist3_titanic_files/figure-html/flujo_superviencia_sexo_clase-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n# Contar una historia\n\n::: {.callout-tip}\n## Cómo narrar una historia convincente con tus datos.\n\nHasta ahora hemos visto el **planteamiento**, en el que proporcionamos el contexto: un colega de departamento nos ha pedido ayuda. Si es científico, como nosotros, podemos utilizar todo nuestro arsenal gráfico sin problemas. Como quiere hacer predicción, está interesado en ver la influencia de las variables en la `supervivencia`.\n\nEl análisis exploratorio nos introduce de lleno en la **trama**, donde descubrimos que la `edad`, el `sexo` y la `clase` tienen influencia en la variable `supervivencia`.\n\nPero como siempre, lo más importante es el **desenlace**, donde le estamos dando a nuestro colega las claves que necesita:\n\n-   Con el gráfico de flujo va a ver claramente como el sexo, la edad y la clase los tiene que tener en cuenta en el modelo: **la tercera clase tuvo un ratio de supervivencia claramente menor, al contrario que las mujeres y los niños**.\n:::\n\n## Para pensar\n\nSi se hundiera hoy en día el Titanic, ¿habría cambiado la influencia de alguna variable en el modelo? ¿Tendríamos una visualización más confusa en el gráfico de flujo?\n\n¿Cómo podría modelizarse la supervivencia, dadas las conclusiones que hemos sacado?",
    "supporting": [
      "hist3_titanic_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}