{
  "hash": "c0737b79e10ad81f8c6d60b80d137216",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"¡Nos vamos a Noruega!\"\nauthor:\n  - Gema Fernández-Avilés (Gema.FAviles@uclm.es)\n  - Isidro Hidalgo (Isidro.Hidalgo@uclm.es)\nformat:\n  html:\n    theme: cerulean\n    highlight-style: ayu-mirage\n    self-contained: true\n    date: \"2025-01-07\"\n    embed-resources: true\n    toc-title: Summary\n    toc: true\n    number-sections: true\n    preview-links: auto\n    code-link: true\n    code-fold: true\nnumber-sections: true\nexecute:\n  echo: true\n  eval: true\n  output: true\n  include: true\n  freeze: auto\n  fig-height: 5\n  warning: false\n  comment: \"#>\"\n  code-line-numbers: true\n  code-copy: true\n  code-overflow: scroll\n  code-fold: true\n---\n\n\n\n::: {.callout-note}\nLos datos que se utilizan en esta historia están disponibles en el repositorio GitHub \"From data to viz\": https://github.com/holtzy/data_to_viz.\n:::\n\n# ¡Nos vamos a Noruega!\n\nMi jefe quiere que le haga un análisis exploratorio (eso dice, pero siempre quiere gráficos guays con conclusiones interesantes...) de unos datos demográficos por países. Lo peor es que quiere que le acompañe a Noruega, que hay un workshop \"fantástico\" [sic]...\n\nCon el frío que hace ahora en Noruega... Pero este hombre, ¿por qué no elige estas cosas con más criterio y nos vamos a Hawai? ¡Por ejemplo!\n\n# Entender el contexto\n\n::: {.callout-tip}\n\n## Cómo definir el propósito y la audiencia de tu análisis\n\nEn este caso, puesto que lo que me pide el jefe es un análisis exploratorio, se trata simplemente de encontrar relaciones interesantes entre variables, mirar su evolución, por si se ven cosas interesantes, y preparar gráficos que vayan al grano, como ya sabemos hacer... ¡Que para algo sirven los cursos de la UCLM!\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Configuración inicial y datos\"}\nlibrary(tidyverse)\nlibrary(GGally)\nlibrary(NbClust)\nlibrary(igraph)\nlibrary(factoextra)\nlibrary(corrplot)\nlibrary(explore)\n\n# Load data\ndemog_data <- read.table(\"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/multivariate.csv\", header = T, sep = \";\")\n\ncolnames(demog_data) <- gsub(\"\\\\.\", \"_\", colnames(demog_data))\nnames(demog_data)[9] <- \"Population_aged_65\"\nhead(demog_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Country  Pop Birth_rate Mortality_rate Life_expectancy\n1 Channel Islands  166      9.280          9.140          81.269\n2         Denmark 5733     10.707          9.620          80.839\n3         Estonia 1302     10.698         12.657          77.342\n4         Finland 5556     10.672          9.865          81.576\n5         Iceland  337     12.836          6.467          83.220\n6         Ireland 4791     13.179          6.562          81.621\n  Infant_mortality Children_per_woman Growth_rate Population_aged_65 Group\n1            7.276              1.492        4.56                 30 North\n2            3.495              1.758        3.67               1132 North\n3            2.843              1.657       -2.63                256 North\n4            1.839              1.764        2.65               1212 North\n5            1.752              1.893        7.83                 50 North\n6            2.385              1.998        8.84                682 North\n  Continent\n1    Europe\n2    Europe\n3    Europe\n4    Europe\n5    Europe\n6    Europe\n```\n\n\n:::\n:::\n\n\n\n::: {.callout-important title=\"Tu turno\"}\nCompleta las partes del código señaladas por `_____` o `xxxxx` para obtener el resultado propuesto. ¿Te acuerdas de las funciones para explorar todas las variables a la vez?\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxxxxxxx(demog_data)\ndemog_data |> xxxxxxx_all()\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n   Country               Pop            Birth_rate    Mortality_rate  \n Length:201         Min.   :     95   Min.   : 7.50   Min.   : 1.600  \n Class :character   1st Qu.:   1198   1st Qu.:11.90   1st Qu.: 6.000  \n Mode  :character   Median :   6213   Median :17.70   Median : 7.500  \n                    Mean   :  36411   Mean   :20.13   Mean   : 7.874  \n                    3rd Qu.:  22445   3rd Qu.:27.50   3rd Qu.: 9.400  \n                    Max.   :1393686   Max.   :48.40   Max.   :16.187  \n Life_expectancy Infant_mortality Children_per_woman  Growth_rate   \n Min.   :48.90   Min.   : 1.30    Min.   :1.03       Min.   :-7.60  \n 1st Qu.:66.80   1st Qu.: 5.50    1st Qu.:1.75       1st Qu.: 3.70  \n Median :74.40   Median :14.50    Median :2.17       Median :11.10  \n Mean   :72.39   Mean   :22.53    Mean   :2.67       Mean   :12.03  \n 3rd Qu.:78.30   3rd Qu.:36.20    3rd Qu.:3.56       3rd Qu.:20.30  \n Max.   :84.60   Max.   :86.80    Max.   :7.43       Max.   :40.10  \n Population_aged_65    Group            Continent        \n Min.   :    5      Length:201         Length:201        \n 1st Qu.:   93      Class :character   Class :character  \n Median :  464      Mode  :character   Mode  :character  \n Mean   : 2370                                           \n 3rd Qu.: 1493                                           \n Max.   :83498                                           \n```\n\n\n:::\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n# Elegir una visualización adecuada\n\n::: {.callout-tip}\n## Selección de gráficos y visualizaciones que mejor representen tus datos.\n:::\n\n## Matriz de puntos\n\nPodemos comenzar por una matriz de puntos de las variables cuantitativas. El paquete `GGally` ofrece una visualización muy elaborada para un primer vistazo con la función `ggpairs()`...\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"matriz de puntos\"}\ndemo_cuanti <- demog_data |>\n   select(Pop, Birth_rate, Mortality_rate, Life_expectancy,\n          Infant_mortality, Children_per_woman,  Growth_rate,\n          Population_aged_65) |>\n   na.omit()\n\ndemo_cuanti |> \n   ggpairs(progress = FALSE)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nHay muchas asociaciones interesantes entre diferentes variables. Aquí ya vemos mucha tela que cortar. Por no extendernos, analizaremos una de las relaciones más adelante. Pero primero, es muy interesante ver la matriz de correlaciones que, aunque con `ggpairs()` teníamos ya una primera impresión, el paquete `corrplot` nos ofrece una visualización ideal con la función `corrplot.mixed()`:\n\n## Matriz de correlaciones\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemo_cuanti |> \n  cor() |> \n  corrplot.mixed( order = 'AOE')\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Gráfico de puntos entre `Growth_rate` y `Life_expectancy`\n\nComo ejemplo, vamos a ver la relación entre la esperanza de vida y la tasa de crecimiento, que ya hemos visto que existe. Empecemos con un gráfico de puntos...\n\n::: {.callout-important title=\"Tu turno\"}\nCompleta las partes del código señaladas por `_____` o `xxxxx` para obtener el resultado propuesto. ¿Te acuerdas de la función de `ggplot2` para una capa de puntos?\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemog_data  |>\n  ggplot(aes(x = Growth_rate, y = Life_expectancy)) +\n  geom_xxxxx() +\n  labs(title = \"Esperanza de vida vs. Tasa de crecimiento\",\n       x = \"Tasa de crecimiento\",\n       y = \"Esperanza de vida\") +\n  theme_minimal()\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"hexbin plot\"}\ndemog_data  |>\n  ggplot(aes(x = Growth_rate, y = Life_expectancy)) +\n  geom_hex() +\n  labs(title = \"Esperanza de vida vs. Tasa de crecimiento\",\n       x = \"Tasa de crecimiento\",\n       y = \"Esperanza de vida\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n# Eliminar el desorden. Enfocar la atención\n\nEn el gráfico anterior no se ve casi nada... solo una ligera tendencia parabólica, pero no sabemos nada de los puntos, ese gráfico aporta poco.\n\n¿Qué herramientas tenemos a nuestro alcance para poner el foco sobre lo que nos interesa? Aquí podemos usar la estética y las facetas, para separar los puntos y dar más información a través de la visualización. Veamos...\n\n## Herramienta 1: la estética\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"gráfico de puntos mejorado por estética\"}\ndemog_data  |>\n  ggplot(aes(x = Growth_rate, y = Life_expectancy, size = Pop,\n             color = Continent)) +\n  geom_point(alpha=0.5) +\n  scale_size(range = c(.1, 20)) +\n  labs(title = \"De Europa a Norteamérica, Oceanía, Sudamérica y África, a través de Asia\",\n       x = \"Tasa de crecimiento\",\n       y = \"Esperanza de vida\") +\n  theme_minimal() +\n  theme(axis.title.x = element_text(hjust = 0),\n        axis.title.y = element_text(hjust = 1))\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nEstamos usando **dos variables para enfocar la atención aportando información: el tamaño del país y el continente**. Solo con eso vemos enseguida por donde van los tiros: la mayor parte de los países de Europa tienen gran esperanza de vida y crecimiento moderado. Por el contrario, Sudamérica tiene tasas de crecimiento muy elevadas (son países en fases de expansión económica) y una menor esperanza de vida, a falta de consolidar sanidad y otros servicios en general.\n\nTambién somos capaces de identificar China e India rápidamente, por su tamaño, y Japón arriba a la izquierda por su tamaño medio-grande y enorme esperanza de vida.\n\nSin embargo, hay colores muy parecidos, que exigen demasiada atención. Podemos usar la siguiente herramienta...\n\n## Herramienta 2: facetas\n\nOtra forma de eliminar el desorden y enfocar la atención es usar facetas, separando el gráfico según una o más variables interesantes. En este caso usamos solo el continente:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"gráfico de puntos mejorado por facetas\"}\ndemog_scatter <- ggplot(data = demog_data, # data\n              aes(x = Growth_rate, y = Life_expectancy, colour = Continent)) + #aesthetics\n    geom_point(alpha = 0.5) + #geometries\n    facet_wrap(~ Continent, scales = \"free\") + #facets\n    labs(title = \"Life expectancy at birth vs. Per capita GDP\", \n         x = \"Growth_rate\", y = \"Life_expectancy\", colour = \"Continent\") + #labels\n    theme_light() #themes\n\ndemog_scatter \n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n::: {#exr-1}\n¿Qué problema podría tener este gráfico?\n:::\n\n::: {.callout-pista}\npista: fijaros en los ejes\n:::\n\nExacto: las escalas. Pero hemos dicho \"podría\", no que tenga un problema en sí. Cuando nuestra intención es mirar dentro de cada faceta para ver la relación entre las variables, es posible que nos interese dejarlo como está.\n\nPero muchas veces es muy importante, cuando usamos facetas, que podamos comparar los diferentes grupos entre sí. En este caso, es imprescindible usar la misma escala en todas las facetas. Para ello, hay que especificar los límites de las escalas de los ejes.\n\n¿Existe una forma fácil de saber cuáles poner? Claro, con un `summary()` de las variables, tal como indicamos a continuación, vemos rápidamente el valor mínimo y máximo de las variables que nos interesan:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"mejoramos la escala para comparar facetas\"}\nsummary(demog_data$Life_expectancy)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  48.90   66.80   74.40   72.39   78.30   84.60 \n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"mejoramos la escala para comparar facetas\"}\nsummary(demog_data$Growth_rate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  -7.60    3.70   11.10   12.03   20.30   40.10 \n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"mejoramos la escala para comparar facetas\"}\ndemog_scatter_escala <- ggplot(data = demog_data,\n                               aes(x = Growth_rate,\n                                   y = Life_expectancy,\n                                   colour = Continent)) +\n  geom_point(alpha = 0.5) +\n  facet_wrap(~ Continent, scales = \"free\") +\n  labs(title = \"Esperanza de vida respecto al PIB per capita\",\n       x = \"Tasa de crecimiento\", y = \"Esperanza de vida\",\n       colour = \"Continent\") +\n  scale_x_continuous(limits = c(-10, 45)) +\n  scale_y_continuous(limits = c(45, 85)) +\n  theme_light()\n\ndemog_scatter_escala \n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n## Linea de suavizado\n\nA veces, si hay una tendencia evidente, es conveniente usar una línea de suavizado que la identifique. En este caso, no está nada clara, por lo que la podemos omitir. Y aquí sí es interesante dejar libre la escala, para maximizar la visualización de la tendencia, que es lo que nos interesa:\n\n::: {.callout-important title=\"Tu turno\"}\nCompleta las partes del código señaladas por `_____` o `xxxxx` para obtener el resultado propuesto. ¿Qué objeto tienes que incluir sobre el que añadir la línea de tendencia?\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n______ + geom_smooth(method = NULL, se = TRUE) \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## Técnicas de segmentación:\n\n### Cluster jerarquizado\n\nUna forma de usar las variables en el análisis exploratorio es agrupar los registros haciendo segmentación. Los clusters se prestan a visualizaciones muy sofisticadas, pero hay que tener cuidado de simplificarlas, porque si no el desorden puede estropear el mensaje. Veamos qué podemos hacer...\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"preparamos los datos para el clúster\"}\ncluster_data <- demog_data |>\n  select(Country) |> # añade esta variable a las cuantitativas\n  cbind(demo_cuanti) |>\n  column_to_rownames(var = \"Country\")\n\nhead(cluster_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Pop Birth_rate Mortality_rate Life_expectancy Infant_mortality\nChannel Islands  166      9.280          9.140          81.269            7.276\nDenmark         5733     10.707          9.620          80.839            3.495\nEstonia         1302     10.698         12.657          77.342            2.843\nFinland         5556     10.672          9.865          81.576            1.839\nIceland          337     12.836          6.467          83.220            1.752\nIreland         4791     13.179          6.562          81.621            2.385\n                Children_per_woman Growth_rate Population_aged_65\nChannel Islands              1.492        4.56                 30\nDenmark                      1.758        3.67               1132\nEstonia                      1.657       -2.63                256\nFinland                      1.764        2.65               1212\nIceland                      1.893        7.83                 50\nIreland                      1.998        8.84                682\n```\n\n\n:::\n:::\n\n\n\nAhora ya podemos empezar la segmentación. Lo primero es estandarizar las variables para impedir que las de mayor rango (distancia entre mínimo y máximo) acaparen demasiado protagonismo...\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"estandarizamos y calculamos las distancias\"}\ncluster_data_stand <- scale(cluster_data)\nd_euclidea <- get_dist(x = cluster_data_stand,\n                       method = \"euclidea\")\nfviz_dist(dist.obj = d_euclidea, lab_size = 5)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\nSe aprecian agrupaciones entre países, pero...\n\n::: {#exr-1}\n...aquí se ve muy poco, de tanta información que hay... ¿qué variable es la culpable?\n:::\n\nAquí conviene hacerse una pregunta: ¿es suficiente agrupar los países por la variable `Group`, que va asociada a la ubicación del país? Si es así, calculamos las medias de las variables por grupo y simplificamos mucho la visualización. Si es imprescindible usar el país, hay que apechugar, porque no hay forma de evitar más de 200 registros...\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"probamos la segmentación por grupos de países\"}\ncluster_data_group <- demog_data |>\n  select(Group) |> # añade esta variable a las cuantitativas\n  cbind(demo_cuanti) |>\n  group_by(Group) |>\n  mutate(across(where(is.numeric), mean)) |>\n  unique()\n\ncluster_data_group <- data.frame(cluster_data_group,\n                                 row.names = 1)\n\ncluster_data_group_stand <- scale(cluster_data_group)\nd_euclidea_group <- get_dist(x = cluster_data_group_stand,\n                       method = \"euclidea\")\nfviz_dist(dist.obj = d_euclidea_group, lab_size = 5)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\nEl resultado es mucho más claro pero, lógicamente, a costa de perder información. En este caso, probablemente se pueda hacer un filtrado de países por grupo, descartando los que nos interesan menos; o centrarnos en una zona geográfica que nos interese más.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"estimación del k óptimo\"}\nset.seed(2025)\n\nnum_cluster <- NbClust(cluster_data_stand, distance = \"euclidean\", method = \"ward.D2\", min.nc = 2, max.nc = 10)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n*** : The Hubert index is a graphical method of determining the number of clusters.\n                In the plot of Hubert index, we seek a significant knee that corresponds to a \n                significant increase of the value of the measure i.e the significant peak in Hubert\n                index second differences plot. \n \n```\n\n\n:::\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-17-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n*** : The D index is a graphical method of determining the number of clusters. \n                In the plot of D index, we seek a significant knee (the significant peak in Dindex\n                second differences plot) that corresponds to a significant increase of the value of\n                the measure. \n \n******************************************************************* \n* Among all indices:                                                \n* 3 proposed 2 as the best number of clusters \n* 9 proposed 3 as the best number of clusters \n* 3 proposed 6 as the best number of clusters \n* 1 proposed 7 as the best number of clusters \n* 5 proposed 9 as the best number of clusters \n* 2 proposed 10 as the best number of clusters \n\n                   ***** Conclusion *****                            \n \n* According to the majority rule, the best number of clusters is  3 \n \n \n******************************************************************* \n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"estimación del k óptimo\"}\nnum_cluster$Best.nc\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    KL       CH Hartigan     CCC    Scott      Marriot   TrCovW\nNumber_clusters 2.0000   2.0000   3.0000 10.0000   7.0000 3.000000e+00     3.00\nValue_Index     2.0596 138.9412  25.0569  9.8187 351.9368 2.002522e+13 12063.16\n                  TraceW Friedman   Rubin Cindex     DB Silhouette   Duda\nNumber_clusters   3.0000   9.0000  9.0000  2.000 9.0000      3.000 6.0000\nValue_Index     123.3405  28.3646 -0.1115  0.155 0.7952      0.463 1.5724\n                PseudoT2  Beale Ratkowsky     Ball PtBiserial Frey McClain\nNumber_clusters    6.000  6.000    3.0000   3.0000      3.000    1  3.0000\nValue_Index       -0.364 -0.962    0.4208 246.2781      0.601   NA  0.3776\n                  Dunn Hubert SDindex Dindex    SDbw\nNumber_clusters 9.0000      0  9.0000      0 10.0000\nValue_Index     0.0956      0  1.5362      0  0.1466\n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"estimación del k óptimo\"}\nhead(num_cluster$Best.partition)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nChannel Islands         Denmark         Estonia         Finland         Iceland \n              1               1               1               1               1 \n        Ireland \n              1 \n```\n\n\n:::\n\n```{.r .cell-code  code-summary=\"estimación del k óptimo\"}\ntable(num_cluster$Best.partition)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  1   2   3 \n135   3  63 \n```\n\n\n:::\n:::\n\n\n\nEl codo del gráfico se sitúa en k = 6, por lo que usaremos una segmentación de 6 grupos.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhc_ward <- hcut(cluster_data_stand , k = 6, hc_method = \"ward.D2\")\nfviz_dend(hc_ward, cex = 0.5, k = 6, main = \"Cluster jerárquico simple\")\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nYa lo habíamos advertido: cuando usamos segmentaciones, normalmente tenemos muchos registros que clasificar. La principal consecuencia es que es inevitable el exceso de información. ¿Lo podemos mejorar? Hay a quien le gustan los gráficos de segmentación circulares. Si es tu caso, esta es una forma de conseguirlo, pero desde el punto de vista de la visualización no creemos que mejore la interpretabilidad de la información:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(5665)\nhc_ward <- hcut(cluster_data_stand, k = 6, hc_method = \"ward.D2\")\nfviz_dend(x = hc_ward, k = 6, type = \"circular\", cex=0.5)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n### K-means\n\nEl paquete `factoextra` ofrece la función `eclust`, que nos permite visualizar un k-means instantáneamente.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\neclust(cluster_data_stand, \"kmeans\", k = 6)\n```\n\n::: {.cell-output-display}\n![](hist4_paises_demog_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nK-means clustering with 6 clusters of sizes 53, 3, 49, 42, 33, 21\n\nCluster means:\n          Pop Birth_rate Mortality_rate Life_expectancy Infant_mortality\n1 -0.12451148 -0.5739811    -0.71563826       0.7583341      -0.68539183\n2  6.97265986 -0.6032555    -0.04989235       0.3365171      -0.30976551\n3 -0.12345596 -0.9950453     1.00974768       0.7013745      -0.77591682\n4 -0.08758811  0.1023943    -0.58595420      -0.1367000       0.02666897\n5 -0.09857430  1.1966628    -0.32515288      -0.8706331       0.93000689\n6 -0.06370841  1.7713121     1.14004714      -1.9569674       2.06974588\n  Children_per_woman Growth_rate Population_aged_65\n1        -0.59421355  -0.2707371        -0.08724756\n2        -0.57940277  -0.4506068         6.35074847\n3        -0.84653058  -1.1825418         0.05888502\n4        -0.04392147   0.1640644        -0.13668936\n5         1.15481359   1.1382521        -0.20344199\n6         1.83082751   1.3901147        -0.23137867\n\nClustering vector:\n                 Channel Islands                          Denmark \n                               3                                3 \n                         Estonia                          Finland \n                               3                                3 \n                         Iceland                          Ireland \n                               1                                1 \n                          Latvia                        Lithuania \n                               3                                3 \n                          Norway                           Sweden \n                               1                                3 \n                  United Kingdom                          Belarus \n                               3                                3 \n                        Bulgaria                   Czech Republic \n                               3                                3 \n                         Hungary                           Poland \n                               3                                3 \n             Republic of Moldova                          Romania \n                               3                                3 \n              Russian Federation                         Slovakia \n                               3                                3 \n                         Ukraine                          Albania \n                               3                                1 \n          Bosnia and Herzegovina                          Croatia \n                               3                                3 \n                          Greece                            Italy \n                               3                                3 \n                           Malta                       Montenegro \n                               3                                3 \n                        Portugal                           Serbia \n                               3                                3 \n                        Slovenia                            Spain \n                               3                                3 \n                  TFYR Macedonia                          Austria \n                               3                                3 \n                         Belgium                           France \n                               3                                3 \n                         Germany                       Luxembourg \n                               3                                1 \n                     Netherlands                      Switzerland \n                               3                                1 \n                          Canada         United States of America \n                               1                                2 \n                         Burundi                          Comoros \n                               6                                5 \n                        Djibouti                          Eritrea \n                               5                                5 \n                        Ethiopia                            Kenya \n                               5                                5 \n                      Madagascar                           Malawi \n                               5                                5 \n                       Mauritius                          Mayotte \n                               3                                4 \n                      Mozambique                          Reunion \n                               6                                1 \n                          Rwanda                       Seychelles \n                               5                                1 \n                         Somalia                      South Sudan \n                               6                                6 \n                          Uganda      United Republic of Tanzania \n                               6                                5 \n                          Zambia                         Zimbabwe \n                               5                                5 \n                          Angola                         Cameroon \n                               6                                6 \n        Central African Republic                             Chad \n                               6                                6 \n                           Congo Democratic Republic of the Congo \n                               5                                6 \n               Equatorial Guinea                            Gabon \n                               6                                5 \n           Sao Tome and Principe                          Algeria \n                               5                                4 \n                           Egypt           Libyan Arab Jamahiriya \n                               4                                4 \n                         Morocco                            Sudan \n                               4                                5 \n                         Tunisia                   Western Sahara \n                               1                                4 \n                        Botswana                          Lesotho \n                               4                                6 \n                         Namibia                     South Africa \n                               5                                4 \n                       Swaziland                            Benin \n                               6                                6 \n                    Burkina Faso                       Cape Verde \n                               6                                4 \n                     Cote Ivoire                           Gambia \n                               6                                5 \n                           Ghana                           Guinea \n                               5                                5 \n                   Guinea-Bissau                          Liberia \n                               6                                5 \n                            Mali                       Mauritania \n                               6                                5 \n                           Niger                          Nigeria \n                               6                                6 \n                         Senegal                     Sierra Leone \n                               5                                6 \n                            Togo              Antigua and Barbuda \n                               5                                1 \n                           Aruba                          Bahamas \n                               3                                1 \n                        Barbados                             Cuba \n                               3                                3 \n                         Curacao               Dominican Republic \n                               1                                4 \n                         Grenada                       Guadeloupe \n                               1                                1 \n                           Haiti                          Jamaica \n                               4                                1 \n                      Martinique                      Puerto Rico \n                               3                                3 \n                     Saint Lucia Saint Vincent and the Grenadines \n                               1                                1 \n             Trinidad and Tobago     United States Virgin Islands \n                               3                                3 \n                          Belize                       Costa Rica \n                               4                                1 \n                     El Salvador                        Guatemala \n                               1                                4 \n                        Honduras                           Mexico \n                               4                                1 \n                       Nicaragua                           Panama \n                               1                                1 \n                       Argentina                          Bolivia \n                               1                                4 \n                          Brazil                            Chile \n                               1                                1 \n                        Colombia                          Ecuador \n                               1                                4 \n                   French Guiana                           Guyana \n                               4                                4 \n                        Paraguay                             Peru \n                               4                                1 \n                        Suriname                          Uruguay \n                               4                                3 \n                       Venezuela                        Australia \n                               1                                1 \n                     New Zealand                             Fiji \n                               1                                4 \n                   New Caledonia                 Papua New Guinea \n                               1                                5 \n                 Solomon Islands                          Vanuatu \n                               5                                4 \n                            Guam                         Kiribati \n                               1                                5 \n     Micronesia (Fed. States of)                 French Polynesia \n                               4                                1 \n                           Samoa                            Tonga \n                               4                                4 \n                           China             China. Hong Kong SAR \n                               2                                1 \n                China. Macao SAR                            Korea \n                               1                                3 \n                           Japan                         Mongolia \n                               3                                4 \n               Republic of Korea                           Taiwan \n                               1                                3 \n               Brunei Darussalam                         Cambodia \n                               1                                4 \n                       Indonesia                             Laos \n                               4                                4 \n                        Malaysia                          Myanmar \n                               1                                4 \n                     Philippines                        Singapore \n                               4                                1 \n                        Thailand                      Timor-Leste \n                               3                                5 \n                        Viet Nam                      Afghanistan \n                               1                                5 \n                      Bangladesh                           Bhutan \n                               4                                4 \n                           India       Iran (Islamic Republic of) \n                               2                                1 \n                      Kazakhstan                       Kyrgyzstan \n                               4                                4 \n                        Maldives                            Nepal \n                               1                                4 \n                        Pakistan                        Sri Lanka \n                               5                                1 \n                      Tajikistan                     Turkmenistan \n                               5                                4 \n                      Uzbekistan                          Armenia \n                               4                                3 \n                      Azerbaijan                          Bahrain \n                               4                                1 \n                          Cyprus                          Georgia \n                               1                                3 \n                            Iraq                           Israel \n                               5                                1 \n                          Jordan                           Kuwait \n                               4                                1 \n                         Lebanon                             Oman \n                               1                                1 \n                       Palestine                            Qatar \n                               5                                1 \n                    Saudi Arabia             Syrian Arab Republic \n                               4                                4 \n                          Turkey             United Arab Emirates \n                               1                                1 \n                           Yemen \n                               5 \n\nWithin cluster sum of squares by cluster:\n[1] 58.40442 79.62078 70.56637 67.02996 38.20593 49.04868\n (between_SS / total_SS =  77.3 %)\n\nAvailable components:\n\n [1] \"cluster\"      \"centers\"      \"totss\"        \"withinss\"     \"tot.withinss\"\n [6] \"betweenss\"    \"size\"         \"iter\"         \"ifault\"       \"clust_plot\"  \n[11] \"silinfo\"      \"nbclust\"      \"data\"        \n```\n\n\n:::\n:::\n\n\n\nVolvemos a tener el mismo problema: las etiquetas de 201 países son demasiada información para presentarla gráficamente.\n\n# Contar una historia\n\n::: {.callout-tip}\n## Cómo narrar una historia convincente con tus datos.\n\nHemos visto el **planteamiento**, en el que proporcionamos el contexto: trabajamos para un jefe que nos ha pedido algo muy concreto: un análisis exploratorio (y sabemos que lo quiere con conclusiones)...\n\nEl análisis exploratorio podemos usarlo para ir introduciendo la **trama**, donde vemos enseguida relaciones interesantes entre algunas parejas de variables... Solo hemos analizado la esperanza de vida al nacer respecto a la tasa de crecimiento, pero en la matriz de puntos hemos visto muchas, por lo que el jefe estará feliz.\n\nLa segmentación también nos ha proporcionado agrupaciones de países, aunque visualmente son difíciles de interpretar, por lo que lo más lógico sería seleccionar un conjunto de países de interés, que consiga un análisis (y su visualización) más interesante.\n\nComo siempre, lo más importante es el **desenlace**, donde le estamos dando a nuestro jefe las claves que necesita:\n\n-   La matriz de puntos es vital, si nuestro superior está habituado al análisis, porque **se aprecia un número importante de relaciones claras entre variables**.\n\n-   En cada variable **podemos usar la estética y las facetas para potenciar la visualización**, determinando las variables que suministran información en las relaciones encontradas.\n\nFinalmente, hemos visto que, cuando tenemos un número elevado de información, tenemos que adoptar una decisión equilibrada entre la información que suministramos en nuestros gráficos y nuestra habilidad para eliminar el desorden y enfocar la mirada del espectador a lo que nos interesa más. Para el caso que nos ocupa, podemos:\n\n-   Usar la agrupación previa por zonas geográficas, como hemos hecho antes.\n\n-   Restringir la visualización a una zona geográfica concreta.\n\n-   Filtrar determinados países para quedarnos con los que nos interesa comparar.\n\n-   Directamente usar una tabla, relacionando todos los países de interés.\n:::\n\n# Para pensar:\n\n::: {.callout}\nA veces no tenemos más remedio que proporcionar una visualización con mucha información, si ésta es clave para nuestro propósito.\n:::\n\n",
    "supporting": [
      "hist4_paises_demog_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}