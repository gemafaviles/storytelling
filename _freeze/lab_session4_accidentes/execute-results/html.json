{
  "hash": "a33b4b49005b240c3016d3312e6d157c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Storytelling visual con R\"\nsubtitle: \"쮺칩mo y d칩nde se producen los accidentes en Madrid?\"\nauthor:   \n  - name: Gema Fern치ndez-Avil칠s \n    email: gema.faviles@uclm.es\n  - name: Isidro Hidalgo\n    email: isidro.hidalgo@uclm.es \ndate: \"2025-03-04\"\nformat:\n  html:\n    theme: cerulean\n    highlight-style: ayu-mirage\n    self-contained: true\n    lang: es\n    date-format: long\n    embed-resources: true\n    toc-title: Summary\n    toc: true\n    number-sections: true\n    preview-links: auto\n    code-link: true\nnumber-sections: true\nexecute:\n  echo: true\n  eval: true\n  output: true\n  include: true\n  freeze: auto\n  fig-height: 5\n  warning: false\n  comment: \"#>\"\n  code-line-numbers: true\n  code-copy: true\n  code-overflow: scroll\n---\n\n\n\n\n\n::: {.callout-warning}\n## IMPORTANTE\n\n**Como buen estudiante que eres, sabr치s lo importante que es trabajar de forma aut칩noma y venir a clase con el material le칤do 游땕**. \n:::\n\n\n\n\n\n::: {.callout-note}\nLos datos que se utilizan en esta historia est치n disponibles en el paquete `CDR` que puede instalarse con el siguiente comando (se comprueba si no lo est치):\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Instalaci칩n y/o carga del paquete `CDR`\"}\nif (!require(CDR)){\n  if (!require(remotes)) {install.packages(\"remotes\")}\n  remotes::install_github(\"cdr-book/CDR\")\n  }\n```\n:::\n\n\n\nAccidentes de tr치fico en la Ciudad de Madrid registrados por Polic칤a Municipal con v칤ctimas y/o da침os al patrimonio en el 2020. Los datos se han descargado del [Portal de datos abiertos del Ayuntamiento de Madrid.](https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=7c2843010d9c3610VgnVCM2000001f4a900aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default))\n:::\n\n# C칩mo y d칩nde se producen los accidentes en Madrid\n\nEsta ma침ana estaba tan tranquilo en mi oficina (trabajo en el distrito de Chamart칤n para el Ayuntamiento) y me sueltan de repente: \"el jefe quiere verte\". Lo primero que he pensado es que me echaban, como soy un poco \"cansa almas\"... Pero no, entro en el despacho del jefe... 춰Y all칤 est치 Almeida! Que ha o칤do que he hecho un curso de visualizaci칩n en la UCLM y me he convertido en un crack de la visualizaci칩n. Yo no sab칤a donde meterme, pero he mantenido perfectamente la compostura, como un profesional.\n\nAs칤 que ya me ha ido contando que est치 muy preocupado con los accidentes y quiere analizar el tema, para buscar soluciones. Que me agradecer칤a mucho si encontramos d칩nde est치 el problema, para bajar el n칰mero y gravedad de los accidentes en la ciudad. El problema, me dice, es que solo me puede facilitar los datos del a침o 2020. Ya le he avisado de que es un a침o muy particular, por el estado de alarma, pero algo sacaremos...\n\n# Entender el contexto\n\n::: {.callout-tip}\n## C칩mo definir el prop칩sito y la audiencia de tu an치lisis\n\n쯈u칠 le interesa al alcalde? Bajar la tasa de accidentes. Pero desde el punto de vista de la visualizaci칩n, est치 claro que va a necesitar informaci칩n georreferenciada, por lo que haremos mapas. Por otro lado, seguro que la dimensi칩n es importante, porque no es lo mismo Madrid en agosto que un d칤a de lluvia en calendario escolar...\n\nEn cualquier caso, lo primero es hacer un an치lisis exploratorio para ver si hay algo raro en los datos y analizar m칤nimamente las variables de inter칠s. Y despu칠s, le vamos a preparar los gr치ficos necesarios para **aportarle conocimiento** sobre los accidentes en la ciudad.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Configuraci칩n inicial y datos\"}\nlibrary(CDR)               # Carga el paquete CDR para la lectura de datos\nlibrary(tidyverse)         # Manipulaci칩n y visualizaci칩n de datos\nlibrary(sf)                # Para trabajar con datos espaciales\nlibrary(mapSpain)          # Para obtener y visualizar mapas de Espa침a\nlibrary(tidyterra)         # Para trabajar con datos espaciales y raster\nlibrary(lubridate)         # Manipulaci칩n de fechas y horas\nlibrary(data.table)        # Para manipulaci칩n eficiente de datos\nlibrary(gplots)            # Carga el paquete gplots para crear gr치ficos avanzados\nlibrary(RColorBrewer)      # Carga el paquete RColorBrewer para paletas de colores\nlibrary(leaflet)           # Carga el paquete leaflet para crear mapas interactivos\nlibrary(leaflet.extras)    # Carga el paquete leaflet.extras para funcionalidades adicionales en leaflet\nlibrary(ggmosaic)          # Carga el paquete ggmosaic para crear gr치ficos de mosaico\n```\n:::\n\n\n\n# Elegir una visualizaci칩n adecuada\n\n::: {.callout-tip}\n## Selecci칩n de gr치ficos y visualizaciones que mejor representen tus datos.\n:::\n\n\n## Almeida quiere saber c칩mo y d칩nde se producen los accidentes en Madrid\n\n::: {#exr-1}\n쮻칩nde se han producido los accidentes de tr치fico en Madrid en el 2020?\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"primer mapa\"}\ndata(accidentes2020_data)\nhead(accidentes2020_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   num_expediente      fecha     hora\n           <char>     <char>   <char>\n1:    2019S040008 07/09/2020 23:00:00\n2:    2019S040008 07/09/2020 23:00:00\n3:    2020S000001 01/01/2020  1:15:00\n4:    2020S000001 01/01/2020  1:15:00\n5:    2020S000002 01/01/2020  1:20:00\n6:    2020S000002 01/01/2020  1:20:00\n                                   localizacion numero            distrito\n                                         <char> <char>              <char>\n1:                    CALL. SAN MAXIMILIANO, 38     38       CIUDAD LINEAL\n2:                    CALL. SAN MAXIMILIANO, 38     38       CIUDAD LINEAL\n3: AVDA. CANILLEJAS A VICALVARO / CALL. SILFIDE      1 SAN BLAS-CANILLEJAS\n4: AVDA. CANILLEJAS A VICALVARO / CALL. SILFIDE      1 SAN BLAS-CANILLEJAS\n5:                            CALL. SILVANO, 31     31           HORTALEZA\n6:                            CALL. SILVANO, 31     31           HORTALEZA\n                 tipo_accidente estado_meteorol칩gico tipo_vehiculo tipo_persona\n                         <char>               <char>        <char>       <char>\n1: Choque contra obst치culo fijo            Despejado       Turismo    Conductor\n2: Choque contra obst치culo fijo            Despejado VMU el칠ctrico    Conductor\n3:      Colisi칩n fronto-lateral                 NULL       Turismo    Conductor\n4:      Colisi칩n fronto-lateral                 NULL       Turismo    Conductor\n5: Choque contra obst치culo fijo            Despejado       Turismo    Conductor\n6: Choque contra obst치culo fijo            Despejado       Turismo     Pasajero\n        rango_edad   sexo lesividad coordenada_x_utm coordenada_y_utm\n            <char> <char>    <char>            <num>            <num>\n1: De 21 a 24 a침os Hombre      NULL         444597.8          4475156\n2: De 25 a 29 a침os  Mujer      NULL         444597.8          4475156\n3: De 18 a 20 a침os Hombre      NULL         447710.6          4477156\n4: De 30 a 34 a침os Hombre      NULL         447710.6          4477156\n5: De 21 a 24 a침os Hombre      NULL         445076.3          4478372\n6: De 40 a 44 a침os Hombre      NULL         445076.3          4478372\n   positiva_alcohol positiva_droga\n             <char>         <char>\n1:                N           NULL\n2:                N           NULL\n3:                N           NULL\n4:                S           NULL\n5:                N           NULL\n6:                N           NULL\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"primer mapa\"}\nggplot(data = accidentes2020_data,                          # Crea un gr치fico con el dataset accidentes2020_data\n       aes(x = coordenada_x_utm, y = coordenada_y_utm)) +   # x= coordenada_x_utm e y= coordenada_y_utm  \n  geom_point() +                                            # A침ade puntos al gr치fico para cada observaci칩n \n  coord_fixed()                                             # Mantiene una relaci칩n fija entre las unidades del eje x y el eje y\n```\n\n::: {.cell-output-display}\n![](lab_session4_accidentes_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n## El desorden es tu enemigo\n\nDeja mucho que desear, 쯨erdad?: no tenemos informaci칩n, solo unos datos representados en un gr치fico. Con muy poco, tirando de est칠tica (reduciendo la dimensi칩n de los puntos para que se vea el fondo) y alguna referencia geogr치fica (en forma de mapa de carreteras), veremos c칩mo se reduce la carga cognitiva:\n\n### Paso 1: # Convierte el dataset accidentes2020_data a un objeto `sf`\n\n\n::: {.cell}\n\n```{.r .cell-code}\naccidentes2020_sf <- st_as_sf(accidentes2020_data,     \n  coords = c(\"coordenada_x_utm\", \"coordenada_y_utm\"),  # Define las columnas de coordenadas UTM\n  crs = 25830                                          # Establece el sistema de referencia de coordenadas a ETRS89/UTM zona 30N, usado en Europa\n)\n```\n:::\n\n\n\n### Paso 2: Obtiene datos del municipio de Madrid con la funci칩n `esp_get_munic` de la libre칤ra `mapSpain`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmadrid <- esp_get_munic(munic = \"^Madrid$\") |>    # Obtiene los datos del municipio de Madrid\n  st_transform(25830)                             # Transforma las coordenadas al sistema de referencia ETRS89/UTM zona 30N\n\n# Descarga una imagen de un mapa est치tico de las carreteras de Madrid\ntile <- esp_getTiles(madrid, \"IDErioja\", zoommin = 2)\n```\n:::\n\n\n\n### Paso 3: Primer mapa mejorado\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +                                     # Inicia un gr치fico vac칤o con ggplot\n  geom_spatraster_rgb(data = tile) +           # A침ade la imagen del mapa est치tico como fondo\n  geom_sf(data = accidentes2020_sf,            # A침ade los datos de accidentes como puntos en el mapa\n    col = \"blue\", size = 0.05, alpha = 0.3) +  # Define el color, tama침o y transparencia de los puntos\n  coord_sf(expand = FALSE) +                   # Mantiene las proporciones de las coordenadas sin expansi칩n\n  labs(title = \"쮻칩nde se producen los accidentes de tr치fico en Madrid?\")   \n```\n\n::: {.cell-output-display}\n![](lab_session4_accidentes_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n춰Esto ya es otra cosa! Apreciamos, l칩gicamente, la concentraci칩n de accidentes en el centro de la ciudad y, especialmente, en las arterias principales.\n\n## El cu치ndo\n\nAdem치s, como hemos comentado, tenemos conocimiento *a priori* sobre la influencia de la fecha en el aumento de tr치fico, por lo que probablemente encontremos alguna influencia de la dimensi칩n temporal. Vamos a verlo...\n\n::: {#exr-2}\n쮺u치ndo se han producido los accidentes? \n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"primer gr치fico del cu치ndo\"}\nggplot(data = accidentes2020_data,\n       aes(x = fecha, y = hora)) + \n  geom_point() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lab_session4_accidentes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::",
    "supporting": [
      "lab_session4_accidentes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}