---
title: "Storytelling visual con R: primera clase"
subtitle: "Curso formativo para el PDI. Universidad de Castilla-La Mancha"
author:   
  - name: Gema Fern치ndez-Avil칠s 
    email: gema.faviles@uclm.es
  - name: Isidro Hidalgo
    email: isidro.hidalgo@uclm.es 
date: "`r Sys.Date()`"
format:
  html:
    theme: cerulean
    highlight-style: ayu-mirage
    self-contained: true
    lang: es
    date-format: long
    embed-resources: true
    toc-title: Summary
    toc: true
    number-sections: true
    preview-links: auto
    code-link: true
number-sections: true
execute:
  echo: true
  eval: true
  output: true
  include: true
  freeze: auto
  fig-height: 5
  warning: false
  comment: "#>"
  code-line-numbers: true
  code-copy: true
  code-overflow: scroll
---



::: {.callout-warning}
## IMPORTANTE

**Como buen estudiante que eres, sabr치s lo importante que es trabajar de forma aut칩noma y venir a clase con el material le칤do**. 
:::


# Unidad 1. 游 Toolkit del curso: R, RStudio y Quarto

El objetivo de esta unidad es presentar **R**, **RStudio** y **Quarto**, herramientas imprescindibles, que utilizar치 a lo largo del curso.


## Prerrequisitos  

Se asume que has revisado las Unidad 1 "Toolkit del curso: R, RStudio y Quarto" y que tienes instalado y funcionando todo lo propuesto en la Unidad O "Calentando motores".

## Terminolog칤a

Ya hemos utilizado algunos t칠rminos nuevos, as칤 que vamos a definirlos antes de continuar.

- **R:** Nombre del lenguaje de programaci칩n que utilizaremos a lo largo del curso.

- **RStudio:** Entorno de desarrollo integrado para R.
    En otras palabras, una interfaz conveniente para escribir y ejecutar c칩digo R.

- **Quarto:** Sistema de publicaci칩n cient칤fica y t칠cnica de c칩digo abierto basado en Pandoc.
Crea y publique art칤culos, informes, presentaciones, sitios web, blogs y libros de alta calidad en HTML, PDF, MS Word, ePub, etc., incluyendo ecuaciones, citas, referencias cruzadas, paneles de figuras, llamadas, dise침o avanzado y mucho m치s.

- **Proyecto:** Un proyecto es un directorio de trabajo (carpeta) que contiene todo lo necesario para trabajar en un an치lisis de datos (proyecto) espec칤fico. Tipos de proyectos: documentos, presentaciones, paquetes, Webs.

## Empezar despacio

A medida que avanza el curso, se anima al estudiante a explorar m치s all치 de lo que dictan las clases.
Sin embargo, antes de llegar a esa etapa, se necesita adquirir cierta fluidez b치sica en **R**.
En primer lugar, comprobemos que el proyecto que hemos creado funciona perfectamente. En el debemos trabajar todo el curso.

`File > New Project > New Directory > Quarto Project > Poner nombre y seleccionar directorio`

Estructura de carpetas dentro del proyecto:

* 游늭 `data`

* 游늭 `img`

::: {.callout-note}
## Quarto

Recuerda que en la **Unidad 1** del curso tienes todo lo necesario para realizar la Tarea 1. 

Una gu칤a detallada sobre Quarto en RStudio est치 disponible en el siguiente enlace: <https://quarto.org/docs/get-started/hello/rstudio.html>

:::


# Unidad 2: 游뚬 La importancia del contexto

## Manos a la obra 

::: {.callout-note}
## R: nuestro contexto

Nosotros vamos a contar historias con los datos usando el software 
estad칤stico **R** por lo que es necesario conocer algunos paquetes y funciones
para poder manipular y representar los datos.
:::

## Toma toda la ayuda que te presten: `dplyr :: Cheatsheet`

<https://rstudio.github.io/cheatsheets/translations/spanish/data-transformation_es.pdf>

- Datos **tidy**: ordenados
- Cada fila es una **observaci칩n**
- Cada columna es una **variable**
- **pipes**` x |> f(y)` ser치 `f(x,y)`


## El conjunto de datos `starwars`

![**Fuente: https://datasciencebox.org**](img/starwars-dataset.png){width="50%"}




## Nuestra filosof칤a: *learning by doing*


1. Cargamos los datos `starwars` contenidos en el paquete `dplyr`.

```{r carga-datos-starwars}
library("dplyr")
starwars
```


2. 쮺u치ntas columnas (variables) tiene?
```{r sw-ncol}
ncol(starwars)
```

3. 쮺u치ntas filas (observaciones) tiene?
```{r sw-nrow}
nrow(starwars)
```

4. 쮺u치l es la dimensi칩n del dataset?
```{r sw-dim}
dim(starwars)
```


5. 쮺칩mo extraer una **variable** del `data.frame`? 

Opci칩n 1: formato tidy
```{r}
#| eval: false
nombre_dataframe |> select(nombre_variable)
```

Opci칩n 2: Con el operador `$`

```{r}
#| eval: false
nombre_dataframe$nombre_variable
```

::: {.callout-important title="Tu turno"}
Selecciona la variable `name` del conjunto de datos `starwars`.
:::

```{r}
# Tu c칩digo R aqu칤
```

6. Para asignar "algo" (la variable `name`) a "algo" (el objeto `sw_name`) se utiliza el operador `<-`.

```{r sw-variable-name}
sw_name <- starwars$name
```


::: {.callout-note}
El operador `<-` asigna al "s칤mbolo" que hay a su izquierda el resultado
de la expresi칩n que hay a su derecha. El operador `=` funciona "igual" que `<-`. 
:::

Completa las partes del c칩digo se침aladas por `_____` o `xxxxx` para obtener el resultado propuesto. 쯊e acuerdas de las funciones para explorar todas las variables a la vez?


7. 쮺omo extraer una observaci칩n del conjunto de datos?

```{r sw-obsev}
#| eval: false
nombre_dataframe|>
  filter(nombre_variable == "nombre_observacion")
```

::: {.callout-important title="Tu turno"}
Selecciona una observaci칩n (el bueno), `Luke Skywalker`, filtrando por el nombre en la variable `name` del conjunto `starwars`
:::


```{r sw-obsev-luke-skywalker}
# Tu c칩digo R aqu칤
```


8. Exploraci칩n del dataset `starwars` de un **vistazo** (con la funci칩n `skim()` de la librer칤a `skimr`):

```{r sw-explora}
skimr::skim(starwars)
```






# Unidad 3. 游늵 La elecci칩n de un gr치fico efectivo: From data to viz


## 쮺칩mo visualizar con la funci칩n `ggplot()` del paquete `ggplot`?

1. Cargamos el paquete `ggplot`
```{r ggplot-library, eval=FALSE}
library(ggplot2)
```


2. Trabajamos con la funci칩n `ggplot()`

```{r ggplot-teoria, eval=FALSE}
ggplot(data = nuestro_dataset, 
       mapping = aes(x = x-variable, y = y-variable)) +
   geom_xxx() +
   otras opciones
```


## 쮺칩mo describir칤as la relaci칩n entre la masa (`mass`) y la altura (`height`) de los personajes de Starwars (`starwars`)? 



## Paso a paso  游

**Paso 游1.** El primer argumento de `ggplot()` es el conjunto de datos que se utilizar치 en el gr치fico 

```{r}
library(ggplot2)
ggplot(data = starwars) 
```


**Paso 游2.** Indicamos a `ggplot()` c칩mo se representar치 visualmente la informaci칩n de nuestros datos. El argumento `mapping` de la funci칩n ggplot() define c칩mo se asignan las variables del conjunto de datos a las propiedades visuales (est칠ticas) del gr치fico. 

La funci칩n `aes()`, y los argumentos `x` e `y` de aes() especifican qu칠 variables mapear a los ejes x e y. Asignaremos `height` a la est칠tica `x` y `mass` a la est칠tica `y`.

```{r starwars2-2}
ggplot(data = starwars,
       mapping = aes(x = height, y = mass)) 
```


**Paso 游3.** Necesitamos definir un **geom**: el objeto geom칠trico que un gr치fico utiliza para representar los datos. Estos objetos geom칠tricos est치n disponibles en `ggplot2` con funciones que empiezan por **geom_**.

Los gr치ficos de barras utilizan `geom_bar()`, los gr치ficos de l칤neas utilizan `geom_line()`, los boxplots utilizan `geom_boxplot()`, los scatterplots utilizan `geom_point()`, etc.

```{r starwars2-3}
ggplot(data = starwars,
       mapping = aes(x = height, y = mass)) + 
  geom_point() 
```


**Paso 游4.** A침ade la variable `gender` en `aes()` para visualizar el g칠nero de cada observaci칩n

```{r starwars2-4 }
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) + 
  geom_point()
```



**Paso 游5.** A침adimos t칤tulo al gr치fico: "Mass vs. height of Starwars characters" 

```{r starwars2-5}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour =gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters")
```


**Paso 游6.** A침adimos el subt칤tulo "by gender"

```{r starwars2-6}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       subtitle = "by gender")
```




**Paso 游7.** Etiquetamos los ejes x e y como con las siguiente expresiones: x = "Height (cm)", y = "Weight (kg)", respectivamente.

```{r starwars2-7}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       subtitle = "by gender",
       x = "Height (cm)", y = "Weight (kg)")
```




**Paso 游8.** Ahora, etiquetamos la leyenda con la expresi칩n: "Species".

```{r starwars2-8 }
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       subtitle = "by gender",
       x = "Height (cm)", y = "Weight (kg)",
       colour = "Gender")
```


**Paso 游9.** A침adimos la fuente de los datos, el paquete `dplyr`.

```{r starwars2-9}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       subtitle = "by gender",
       x = "Height (cm)", y = "Weight (kg)",
       colour = "Gender",
       caption = "Source: dplyr package")
```


**Paso 游10.** Finalmente, usamos paleta con una escala de colores discreta que est치 dise침ada para ser percibida por espectadores con formas comunes de daltonismo, `scale_colour_viridis_d()`.

```{r starwars2-10}
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = gender)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       subtitle = "by gender",
       x = "Height (cm)", y = "Weight (kg)",
       colour = "Gender",
       caption = "Source: dplyr package")  +
  scale_colour_viridis_d()
```



## Aesthetics (est칠tica) `r emo::ji("hit")`  {background-color="#017eae"}

```{r aes-col, eval= FALSE }
ggplot(data = starwars,
       mapping = aes(x = height,
                     y = mass,
                     colour = xxxxx,
                     shape = xxxxx,
                     size = xxxxx,
                     alpha = xxxxx)
       ) +
  geom_point()
```




